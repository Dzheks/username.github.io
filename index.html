<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NovaShop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
:root{
 --accent:#22c55e;
 --bg1:#0f172a;
 --bg2:#020617;
}

body{
 min-height:100vh;
 background:radial-gradient(circle at top,var(--bg1),var(--bg2));
 color:#fff;
 overflow:hidden;
}

/* ===== SCREENS ===== */
.screen{
 position:absolute;
 inset:0;
 padding:20px 20px 90px;
 transform:translateX(100%);
 transition:transform .35s cubic-bezier(.4,0,.2,1);
}
.screen.active{transform:translateX(0)}
.screen.left{transform:translateX(-100%)}

/* ===== UI ===== */
header{text-align:center;margin-bottom:20px}
header h1{font-size:30px}

.catalog{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
 gap:20px;
 max-width:1000px;
 margin:auto;
}

.card{
 background:rgba(255,255,255,.07);
 border-radius:18px;
 overflow:hidden;
 backdrop-filter:blur(14px);
 transition:.25s;
 cursor:pointer;
}
.card:hover{transform:translateY(-6px)}
.card img{width:100%;height:140px;object-fit:cover}
.card-body{padding:14px}

.buy{
 width:100%;
 padding:11px;
 border:none;
 border-radius:12px;
 background:var(--accent);
 font-weight:600;
 cursor:pointer;
}
.buy.crypto{
 background:#0ea5e9;
 margin-top:8px;
}

.nav{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:#020617;
 display:flex;
 justify-content:space-around;
 padding:12px 0;
}
.nav button{
 background:none;border:none;color:#94a3b8;font-weight:600;
}
.nav .active{color:var(--accent)}

.cart-item{
 background:rgba(255,255,255,.07);
 border-radius:14px;
 padding:12px;
 margin-bottom:10px;
 display:flex;
 justify-content:space-between;
}
</style>
</head>
<body>

<!-- ===== SCREENS ===== -->
<div class="screen active" id="shop">
<header><h1>NovaShop</h1></header>
<div class="catalog" id="catalog"></div>
</div>

<div class="screen" id="cart">
<header><h1>–ö–æ—Ä–∑–∏–Ω–∞</h1></header>
<div id="cartList"></div>
<h3 id="total"></h3>
<button class="buy" onclick="payCrypto()">ü™ô –û–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π</button>
</div>

<div class="screen" id="profile">
<header><h1>–ü—Ä–æ—Ñ–∏–ª—å</h1></header>
<p id="user"></p>
<div id="orders"></div>
</div>

<!-- ===== NAV ===== -->
<div class="nav">
<button class="active" onclick="go('shop',this)">–ú–∞–≥–∞–∑–∏–Ω</button>
<button onclick="go('cart',this)">–ö–æ—Ä–∑–∏–Ω–∞</button>
<button onclick="go('profile',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>

<script>
/* ===== SAFE TELEGRAM ===== */
const tg = window.Telegram?.WebApp || {
 expand(){},
 sendData: console.log,
 showAlert: alert,
 themeParams: {}
};

tg.expand();

if(tg.themeParams?.button_color){
 document.documentElement.style.setProperty("--accent",tg.themeParams.button_color);
}

/* ===== DATA (–æ–±—ã—á–Ω–æ –≥—Ä—É–∑–∏—Ç—Å—è –∏–∑ data.json) ===== */
const products=[
 {id:1,name:"PS Plus Essential",price:499},
 {id:2,name:"PS Plus Extra",price:799},
 {id:3,name:"Steam Wallet 1000 ‚ÇΩ",price:1000}
];

let cart = JSON.parse(localStorage.getItem("cart")||"[]");
let orders = JSON.parse(localStorage.getItem("orders")||"[]");
let current="shop";

/* ===== CATALOG ===== */
const catalog=document.getElementById("catalog");
products.forEach(p=>{
 const c=document.createElement("div");
 c.className="card";
 c.innerHTML=`
 <div class="card-body">
 <h3>${p.name}</h3>
 <div>${p.price} ‚ÇΩ</div>
 <button class="buy">–í –∫–æ—Ä–∑–∏–Ω—É</button>
 </div>`;
 c.querySelector(".buy").onclick=e=>{
  e.stopPropagation();
  cart.push(p);
  localStorage.setItem("cart",JSON.stringify(cart));
  tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É");
 };
 catalog.appendChild(c);
});

/* ===== CART ===== */
function renderCart(){
 const l=document.getElementById("cartList");
 l.innerHTML="";
 let sum=0;
 cart.forEach(p=>{
  sum+=p.price;
  l.innerHTML+=`<div class="cart-item"><span>${p.name}</span><b>${p.price} ‚ÇΩ</b></div>`;
 });
 document.getElementById("total").innerText="–ò—Ç–æ–≥–æ: "+sum+" ‚ÇΩ";
}

/* ===== CRYPTO PAYMENT ===== */
function payCrypto(){
 if(!cart.length) return;

 const total = cart.reduce((s,p)=>s+p.price,0);

 tg.sendData(JSON.stringify({
  action: "crypto_invoice",
  total: total,
  items: cart
 }));

 tg.showAlert("ü™ô –°—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.\n–ü—Ä–æ–≤–µ—Ä—å —á–∞—Ç —Å –±–æ—Ç–æ–º.");
}

/* ===== PROFILE ===== */
document.getElementById("user").innerText =
 tg.initDataUnsafe?.user?.username
 ? "@"+tg.initDataUnsafe.user.username
 : "–ì–æ—Å—Ç—å";

function renderOrders(){
 const o=document.getElementById("orders");
 o.innerHTML="";
 orders.forEach(or=>{
  o.innerHTML+=`
   <div class="cart-item">
    <span>${or.date}</span>
    <b>${or.total} ‚ÇΩ</b>
   </div>`;
 });
}

/* ===== NAVIGATION + SLIDE ===== */
function go(id,btn){
 const cur=document.getElementById(current);
 const next=document.getElementById(id);
 cur.classList.remove("active");
 cur.classList.add("left");
 next.classList.add("active");
 current=id;

 document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
 btn.classList.add("active");

 if(id==="cart")renderCart();
 if(id==="profile")renderOrders();
}

/* ===== SWIPE ===== */
let sx=0;
document.addEventListener("touchstart",e=>sx=e.touches[0].clientX);
document.addEventListener("touchend",e=>{
 let dx=e.changedTouches[0].clientX-sx;
 if(Math.abs(dx)<80)return;
 const order=["shop","cart","profile"];
 let i=order.indexOf(current);
 if(dx<0 && i<order.length-1) go(order[i+1],document.querySelectorAll(".nav button")[i+1]);
 if(dx>0 && i>0) go(order[i-1],document.querySelectorAll(".nav button")[i-1]);
});
</script>
</body>
</html>
