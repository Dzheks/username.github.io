<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>NovaShop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui}
:root{
 --accent:#22c55e;
 --bg:#0f172a;
}

body{
 background:var(--bg);
 color:#fff;
 min-height:100vh;
 padding-bottom:90px;
}

header{text-align:center;margin:20px 0}
header h1{font-size:30px}

/* ===== SCREENS ===== */
.screen{display:none;padding:0 16px}
.screen.active{display:block}

/* ===== CATALOG ===== */
.catalog{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
 gap:16px;
 max-width:1000px;
 margin:auto;
}

.card{
 background:rgba(255,255,255,.08);
 border-radius:16px;
 overflow:hidden;
}

.card-body{padding:12px}

.card h3{font-size:15px;margin-bottom:6px}
.price{opacity:.8;margin-bottom:10px}

button{
 width:100%;
 border:none;
 border-radius:12px;
 padding:10px;
 font-weight:600;
 cursor:pointer;
}

.buy{background:var(--accent);color:#000}
.crypto{background:#0ea5e9;margin-top:8px}

/* ===== NAV ===== */
.nav{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:#020617;
 display:flex;
 justify-content:space-around;
 padding:12px 0;
}

.nav button{
 background:none;
 color:#94a3b8;
}

.nav .active{color:var(--accent)}

/* ===== CART / ORDERS ===== */
.item{
 background:rgba(255,255,255,.08);
 border-radius:12px;
 padding:10px;
 margin-bottom:10px;
 display:flex;
 justify-content:space-between;
}
</style>
</head>
<body>

<header>
  <h1>NovaShop</h1>
</header>

<!-- ===== SCREENS ===== -->
<div class="screen active" id="shop">
  <div class="catalog" id="catalog"></div>
</div>

<div class="screen" id="cart">
  <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
  <div id="cartList"></div>
  <h3 id="total"></h3>
  <button class="crypto" onclick="payCrypto()">ü™ô –û–ø–ª–∞—Ç–∏—Ç—å –∫—Ä–∏–ø—Ç–æ–π</button>
</div>

<div class="screen" id="profile">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <p id="user"></p>
  <div id="orders"></div>
</div>

<div class="screen" id="admin">
  <h2>–ê–¥–º–∏–Ω–∫–∞</h2>
  <div id="adminOrders"></div>
</div>

<!-- ===== NAV ===== -->
<div class="nav" id="nav">
  <button class="active" onclick="openScreen('shop',this)">–ú–∞–≥–∞–∑–∏–Ω</button>
  <button onclick="openScreen('cart',this)">–ö–æ—Ä–∑–∏–Ω–∞</button>
  <button onclick="openScreen('profile',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>

<script>
/* ===== SAFE TELEGRAM ===== */
const tg = window.Telegram?.WebApp || {
 expand(){},
 sendData:console.log,
 showAlert:alert,
 themeParams:{}
};
tg.expand();

/* ===== ADMIN ===== */
const ADMIN_IDS=[123456789]; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π TG ID
const userId = tg.initDataUnsafe?.user?.id || 123456789; // fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
const isAdmin = ADMIN_IDS.includes(userId);

if(isAdmin){
 document.getElementById("nav").innerHTML +=
  `<button onclick="openScreen('admin',this)">–ê–¥–º–∏–Ω</button>`;
}

/* ===== DATA ===== */
const products=[
 {id:1,name:"PS Plus Essential",price:499},
 {id:2,name:"PS Plus Extra",price:799},
 {id:3,name:"PS Plus Deluxe",price:1099},
 {id:4,name:"Steam Wallet 1000 ‚ÇΩ",price:1000},
 {id:5,name:"Steam Wallet 3000 ‚ÇΩ",price:3000},
 {id:6,name:"Xbox Game Pass",price:899}
];

let cart = JSON.parse(localStorage.getItem("cart")||"[]");
let orders = JSON.parse(localStorage.getItem("orders")||"[]");

/* ===== CATALOG ===== */
const catalog=document.getElementById("catalog");
products.forEach(p=>{
 const c=document.createElement("div");
 c.className="card";
 c.innerHTML=`
  <div class="card-body">
    <h3>${p.name}</h3>
    <div class="price">${p.price} ‚ÇΩ</div>
    <button class="buy">–í –∫–æ—Ä–∑–∏–Ω—É</button>
  </div>`;
 c.querySelector(".buy").onclick=()=>{
  cart.push(p);
  localStorage.setItem("cart",JSON.stringify(cart));
  tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É");
 };
 catalog.appendChild(c);
});

/* ===== CART ===== */
function renderCart(){
 const l=document.getElementById("cartList");
 l.innerHTML="";
 let sum=0;
 cart.forEach(p=>{
  sum+=p.price;
  l.innerHTML+=`<div class="item"><span>${p.name}</span><b>${p.price} ‚ÇΩ</b></div>`;
 });
 document.getElementById("total").innerText="–ò—Ç–æ–≥–æ: "+sum+" ‚ÇΩ";
}

/* ===== PAY ===== */
function payCrypto(){
 if(!cart.length)return;
 const total = cart.reduce((s,p)=>s+p.price,0);
 tg.sendData(JSON.stringify({
  action:"crypto_invoice",
  total,
  items:cart
 }));
 tg.showAlert("–°—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç—É");
}

/* ===== PROFILE ===== */
document.getElementById("user").innerText =
 tg.initDataUnsafe?.user?.username ? "@"+tg.initDataUnsafe.user.username : "–ì–æ—Å—Ç—å";

function renderOrders(){
 const o=document.getElementById("orders");
 o.innerHTML="";
 orders.forEach(or=>{
  o.innerHTML+=`<div class="item"><span>${or.date}</span><b>${or.total} ‚ÇΩ</b></div>`;
 });
}

/* ===== ADMIN ===== */
function renderAdmin(){
 const a=document.getElementById("adminOrders");
 a.innerHTML="";
 orders.forEach(or=>{
  a.innerHTML+=`<div class="item"><span>#${or.id}</span><b>${or.total} ‚ÇΩ</b></div>`;
 });
}

/* ===== NAV ===== */
function openScreen(id,btn){
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
 btn.classList.add("active");
 if(id==="cart")renderCart();
 if(id==="profile")renderOrders();
 if(id==="admin")renderAdmin();
}
</script>

</body>
</html>
