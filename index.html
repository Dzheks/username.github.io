<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NovaShop</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --bg:#0d0f12;
  --card:#16191d;
  --text:#fff;
  --muted:#a0a0a0;
  --blue:#2b8eff;
  --green:#00d977;
  --radius:18px;
}

*{box-sizing:border-box;font-family:system-ui;color:var(--text)}
body{margin:0;background:var(--bg);padding:16px;padding-bottom:90px}

header{text-align:center;font-size:1.6rem;font-weight:600;margin-bottom:16px}

.categories{display:flex;gap:8px;justify-content:center;margin-bottom:16px;flex-wrap:wrap}
.category-btn{
  background:var(--card);border:none;border-radius:999px;
  padding:8px 14px;color:var(--muted);font-weight:600
}
.category-btn.active{background:var(--blue);color:#fff}

.catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px}
.card{
  background:var(--card);border-radius:var(--radius);
  overflow:hidden;display:flex;flex-direction:column
}
.card img{width:100%;height:130px;object-fit:cover}
.card-content{padding:12px;flex:1;display:flex;flex-direction:column;justify-content:space-between}

.btn{
  border:none;border-radius:var(--radius);
  padding:10px;font-weight:700;font-size:.95rem
}
.btn-blue{background:var(--blue)}
.btn-green{background:var(--green);color:#000}
.btn-red{background:#ff5555}

.footer{
  position:fixed;bottom:0;left:0;width:100%;
  background:#141619;display:flex;justify-content:space-around;
  padding:10px 0
}
.nav-btn{background:none;border:none;color:var(--muted);font-weight:600}
.nav-btn.active{color:var(--green)}

.screen{display:none;flex-direction:column;min-height:100vh}
.screen.active{display:flex}

.cart-item{
  background:var(--card);border-radius:var(--radius);
  padding:12px;display:flex;justify-content:space-between;align-items:center;
  margin-bottom:10px
}

.profile-card{
  background:var(--card);border-radius:var(--radius);
  padding:16px;text-align:center;margin-bottom:16px
}
</style>
</head>

<body>

<!-- –ö–ê–¢–ê–õ–û–ì -->
<div class="screen active" id="catalogScreen">
<header>üõç NovaShop</header>

<div class="categories" id="categories">
<button class="category-btn active" data-cat="all">–í—Å–µ</button>
<button class="category-btn" data-cat="PlayStation">PlayStation</button>
<button class="category-btn" data-cat="Steam">Steam</button>
<button class="category-btn" data-cat="Xbox">Xbox</button>
</div>

<div class="catalog" id="catalog"></div>
</div>

<!-- –ö–û–†–ó–ò–ù–ê -->
<div class="screen" id="cartScreen">
<header>üõí –ö–æ—Ä–∑–∏–Ω–∞</header>
<div id="cartItems"></div>
<div id="cartTotal" style="font-weight:700;text-align:right;margin:12px 0">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
<button class="btn btn-green" id="goPay">üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
<button class="btn btn-red" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
</div>

<!-- –û–§–û–†–ú–õ–ï–ù–ò–ï -->
<div class="screen" id="checkoutScreen">
<header>üí≥ –û–ø–ª–∞—Ç–∞</header>
<div class="profile-card">
<p>–û–ø–ª–∞—Ç–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–π —É—Å–ª—É–≥–∏</p>
<p>üí≥ –ö–∞—Ä—Ç–∞: <b>2202 0000 0000 1234</b></p>
<p>üë§ –ü–æ–ª—É—á–∞—Ç–µ–ª—å: Ivan I.</p>
</div>
<button class="btn btn-green" id="confirmPay">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div class="screen" id="profileScreen">
<header>üë§ –ü—Ä–æ—Ñ–∏–ª—å</header>
<div class="profile-card">
<h3 id="username">–ì–æ—Å—Ç—å</h3>
<p style="color:var(--muted)">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</p>
</div>
<div id="orders"></div>
</div>

<!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
<div class="footer">
<button class="nav-btn active" data-screen="catalogScreen">üè† –ú–∞–≥–∞–∑–∏–Ω</button>
<button class="nav-btn" data-screen="cartScreen">üõí –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)</button>
<button class="nav-btn" data-screen="profileScreen">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();

const products = [
{id:1,cat:"PlayStation",name:"PS Plus Essential",price:2500,img:"https://i.imgur.com/DXrGv1g.jpg"},
{id:2,cat:"PlayStation",name:"PS Plus Extra",price:3500,img:"https://i.imgur.com/XO1VgRQ.jpg"},
{id:3,cat:"PlayStation",name:"PS Plus Deluxe",price:4500,img:"https://i.imgur.com/n0fxZgP.jpg"},
{id:4,cat:"Steam",name:"Steam Wallet 1000‚ÇΩ",price:1000,img:"https://i.imgur.com/zP8Q6Do.jpg"},
{id:5,cat:"Steam",name:"Steam Wallet 3000‚ÇΩ",price:3000,img:"https://i.imgur.com/3HZYwOe.jpg"},
{id:6,cat:"Xbox",cat2:"Xbox",name:"Xbox Game Pass",price:2000,img:"https://i.imgur.com/Xb1Elnx.jpg"},
];

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let orders = JSON.parse(localStorage.getItem("orders")) || [];
let currentCat="all";

const catalog=document.getElementById("catalog");
const cartItems=document.getElementById("cartItems");
const cartTotal=document.getElementById("cartTotal");
const cartCount=document.getElementById("cartCount");
const ordersEl=document.getElementById("orders");

document.getElementById("username").textContent =
tg.initDataUnsafe?.user?.username ? "@"+tg.initDataUnsafe.user.username : "–ì–æ—Å—Ç—å";

function renderCatalog(){
catalog.innerHTML="";
products.filter(p=>currentCat==="all"||p.cat===currentCat).forEach(p=>{
catalog.innerHTML+=`
<div class="card">
<img src="${p.img}">
<div class="card-content">
<h4>${p.name}</h4>
<b>${p.price} ‚ÇΩ</b>
<button class="btn btn-blue" onclick="addToCart(${p.id})">–î–æ–±–∞–≤–∏—Ç—å</button>
</div></div>`;
});
}

function addToCart(id){
const item=cart.find(i=>i.id===id);
item?item.qty++:cart.push({id,qty:1});
save(); renderCart(); tg.showAlert("–î–æ–±–∞–≤–ª–µ–Ω–æ");
}

function renderCart(){
cartItems.innerHTML="";
let total=0,count=0;
cart.forEach(i=>{
const p=products.find(pr=>pr.id===i.id);
total+=p.price*i.qty; count+=i.qty;
cartItems.innerHTML+=`
<div class="cart-item">
<span>${p.name}</span>
<div>
<button onclick="changeQty(${i.id},-1)">‚àí</button>
<b>${i.qty}</b>
<button onclick="changeQty(${i.id},1)">+</button>
</div>
</div>`;
});
cartTotal.textContent=`–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`;
cartCount.textContent=count;
save();
}

function changeQty(id,d){
const i=cart.find(x=>x.id===id);
i.qty+=d; if(i.qty<=0) cart=cart.filter(x=>x.id!==id);
renderCart();
}

function clearCart(){cart=[];renderCart();}

document.getElementById("goPay").onclick=()=>switchScreen("checkoutScreen");

document.getElementById("confirmPay").onclick=()=>{
const items=cart.map(i=>{
const p=products.find(pr=>pr.id===i.id);
return `${p.name} x${i.qty}`;
});
const total=cart.reduce((s,i)=>s+products.find(p=>p.id===i.id).price*i.qty,0);
const order={items,total,date:new Date().toLocaleString()};
orders.push(order); localStorage.setItem("orders",JSON.stringify(orders));
tg.sendData(JSON.stringify(order));
cart=[]; renderCart(); renderOrders();
tg.showAlert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"); switchScreen("catalogScreen");
};

function renderOrders(){
ordersEl.innerHTML="";
orders.slice().reverse().forEach(o=>{
ordersEl.innerHTML+=`
<div class="profile-card">
<b>${o.date}</b>
<p>${o.items.join(", ")}</p>
<p>–°—É–º–º–∞: ${o.total} ‚ÇΩ</p>
</div>`;
});
}

function save(){localStorage.setItem("cart",JSON.stringify(cart));}

function switchScreen(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.querySelectorAll(".nav-btn").forEach(b=>{
b.classList.toggle("active",b.dataset.screen===id);
});
if(id==="profileScreen") renderOrders();
}

document.querySelectorAll(".nav-btn").forEach(b=>b.onclick=()=>switchScreen(b.dataset.screen));
document.querySelectorAll(".category-btn").forEach(b=>b.onclick=()=>{
document.querySelectorAll(".category-btn").forEach(x=>x.classList.remove("active"));
b.classList.add("active"); currentCat=b.dataset.cat; renderCatalog();
});

renderCatalog(); renderCart(); renderOrders();
</script>

</body>
</html>
